# 教程 4: 测试 Skills

测试是确保 Skill 质量和可靠性的关键步骤。本教程将教你如何系统地测试你的 Skills。

## 教程目标

完成本教程后，你将：

- 理解测试的重要性
- 掌握测试方法和技巧
- 学会调试和修复问题
- 能够建立测试流程

## 为什么测试很重要？

### 测试的价值

1. **发现 Bug** - 在用户发现前找到问题
2. **验证功能** - 确保按预期工作
3. **改进体验** - 发现用户痛点
4. **建立信心** - 发布时更有把握

### 测试 vs 不测试

| 方面 | 不测试 | 测试 |
|------|--------|------|
| Bug 发现率 | 用户发现 | 开发时发现 |
| 修复成本 | 高（已发布） | 低（开发中） |
| 用户体验 | 差（遇到 Bug） | 好（经过验证） |
| 维护难度 | 高（不敢改动） | 低（有测试保护） |

## 测试类型

### 1. 功能测试

验证 Skill 的核心功能是否正常工作。

**测试内容**：

- 正常输入是否能产生正确输出
- 边界值是否能正确处理
- 错误输入是否能友好处理

**示例**：测试文件重命名 Skill

```bash
# 测试 1: 正常重命名
输入: old-name.txt → new-name.txt
预期: 文件成功重命名

# 测试 2: 目标文件已存在
输入: file.txt → existing-file.txt
预期: 提示文件已存在，询问是否覆盖

# 测试 3: 源文件不存在
输入: nonexistent.txt → new.txt
预期: 友好错误提示
```

### 2. 集成测试

测试 Skill 与工具（Read、Write、Bash 等）的集成。

**测试内容**：

- 工具调用是否正确
- 权限是否足够
- 错误处理是否完善

**示例**：测试需要 Bash 工具的 Skill

```bash
# 测试 Bash 调用
- 验证命令格式正确
- 检查命令是否有执行权限
- 测试命令失败时的处理
```

### 3. 用户体验测试

从用户角度测试 Skill 的易用性。

**测试内容**：

- 指令是否清晰
- 输出是否易于理解
- 错误信息是否有帮助

**示例**：测试 Skill 输出

```
❌ 不好的输出：
处理完成

✅ 好的输出：
✅ 处理完成

已处理 5 个文件：
- file1.txt: 成功
- file2.txt: 成功
- file3.txt: 跳过（已存在）
- file4.txt: 成功
- file5.txt: 成功

总结：成功 4 个，跳过 1 个
```

## 测试方法

### 方法 1: 手动测试

最直接的测试方法，适合小规模测试。

**步骤**：

1. **准备测试环境**

   ```bash
   # 创建测试目录
   mkdir test-skill
   cd test-skill

   # 准备测试数据
   echo "test content" > test-file.txt
   ```

2. **运行 Skill**

   ```
   my-skill
   ```

3. **验证结果**
   - 检查输出是否正确
   - 验证文件是否正确修改
   - 确认错误处理

4. **记录结果**

   ```markdown
   # 测试记录

   ## 测试 1: 正常输入
   - 输入: test-file.txt
   - 预期: 成功处理
   - 实际: ✅ 成功
   - 结果: PASS
   ```

### 方法 2: 边界测试

测试极端情况和边界值。

**测试场景**：

```markdown
## 边界测试清单

### 空输入
- 空字符串: ""
- 空列表: []
- 空对象: {}

### 极大输入
- 100MB 文件
- 10000 行文本
- 深层嵌套结构

### 特殊字符
- Unicode: 😊 🎉
- 特殊符号: @#$%^&*
- 换行符、制表符

### 无效输入
- 不存在的文件
- 无效的格式
- 错误的类型
```

### 方法 3: 错误场景测试

故意触发错误，验证 Skill 的处理能力。

**测试场景**：

```markdown
## 错误场景测试

### 1. 权限错误
测试：尝试读取无权限的文件
预期：友好错误提示

### 2. 资源不足
测试：处理超大文件
预期：警告或分块处理

### 3. 格式错误
测试：提供错误格式的输入
预期：指出错误并给出正确示例

### 4. 并发冲突
测试：同时操作同一文件
预期：检测冲突并提示
```

## 调试技巧

### 技巧 1: 分步测试

不要一次测试整个流程，分步测试。

```markdown
## 分步测试策略

### 第 1 步: 测试 Frontmatter
验证元数据是否正确：
- name 格式正确
- description 清晰
- allowed-tools 声明正确

### 第 2 步: 测试单个操作
只测试一个功能：
- 只测试读取功能
- 验证读取是否正常

### 第 3 步: 测试完整流程
在单步测试通过后，测试完整流程
```

### 技巧 2: 添加调试输出

在 Skill 中添加临时调试信息：

```markdown
# 临时调试输出

[DEBUG] 开始处理
[DEBUG] 输入: {user_input}
[DEBUG] 读取到 {line_count} 行
[DEBUG] 处理完成

正常输出...
```

**注意**：发布前记得移除调试输出！

### 技巧 3: 简化测试

先测试简化版本，再逐步增加复杂度。

```
版本 1: 最简单的实现（无错误处理）
版本 2: 添加基本错误处理
版本 3: 添加详细错误处理
版本 4: 添加边界情况处理
版本 5: 完整功能
```

### 技巧 4: 使用测试工具

创建测试脚本：

```bash
#!/bin/bash
# test-skill.sh

echo "测试 1: 正常输入"
claude my-skill --input "test-data.txt"
# 验证输出

echo "测试 2: 空输入"
claude my-skill --input ""
# 验证错误处理

echo "测试 3: 不存在的文件"
claude my-skill --input "nonexistent.txt"
# 验证错误提示
```

## 测试清单

### 完整测试清单

使用这个清单确保全面测试：

#### 功能测试

- [ ] 核心功能正常工作
- [ ] 输出符合预期格式
- [ ] 所有选项都被测试
- [ ] 工具调用正确

#### 边界测试

- [ ] 空输入处理
- [ ] 极大输入处理
- [ ] 特殊字符处理
- [ ] 极限值处理

#### 错误测试

- [ ] 文件不存在
- [ ] 权限不足
- [ ] 格式错误
- [ ] 网络错误（如适用）

#### 用户体验测试

- [ ] 输出清晰易读
- [ ] 错误信息友好
- [ ] 进度反馈及时
- [ ] 帮助信息完整

#### 性能测试

- [ ] 响应时间可接受
- [ ] 内存使用合理
- [ ] 大文件不卡顿
- [ ] 并发处理正确

## 实践：测试一个 Skill

让我们完整测试一个 Skill：`file-counter`

### 准备测试环境

```bash
# 创建测试目录
mkdir test-file-counter
cd test-file-counter

# 创建测试文件
mkdir src tests
touch src/main.js src/utils.js tests/test.js
echo "content" > readme.md
```

### 测试用例

#### 测试 1: 正常输入

```markdown
**输入**: src

**预期输出**:
# 文件统计
**目录**: src
**总文件数**: 2

**实际输出**: [记录实际输出]

**结果**: ✅ PASS / ❌ FAIL
```

#### 测试 2: 不存在的目录

```markdown
**输入**: nonexistent

**预期输出**:
❌ 目录不存在：nonexistent
请检查路径...

**实际输出**: [记录实际输出]

**结果**: ✅ PASS / ❌ FAIL
```

#### 测试 3: 空目录

```bash
mkdir empty-dir
```

```markdown
**输入**: empty-dir

**预期输出**:
# 文件统计
**目录**: empty-dir
**总文件数**: 0

**实际输出**: [记录实际输出]

**结果**: ✅ PASS / ❌ FAIL
```

## 调试常见问题

### 问题 1: Skill 没有响应

**可能原因**：

- Frontmatter 格式错误
- 工具未声明

**调试步骤**：

1. 检查 YAML 格式

```bash
# 使用 YAML 验证工具
yamllint SKILL.md
```

1. 验证工具声明

```yaml
allowed-tools:
  - Read
  - Write
  - Bash
```

### 问题 2: 输出不正确

**可能原因**：

- 指令不够清晰
- 步骤顺序错误

**调试步骤**：

1. 添加调试输出
2. 逐步验证每个步骤
3. 对比预期输出和实际输出

### 问题 3: 工具调用失败

**可能原因**：

- 文件路径错误
- 权限不足
- 工具未声明

**调试步骤**：

1. 验证文件路径
2. 检查文件权限
3. 确认工具在 allowed-tools 中

## 自动化测试

对于复杂的 Skills，可以考虑自动化测试：

```javascript
// test-skill.js
const { test } = require('tester');

test('file-counter', async (skill) => {
  // 测试正常输入
  const result1 = await skill.run('src');
  assert(result1.totalFiles > 0);

  // 测试空目录
  const result2 = await skill.run('empty-dir');
  assert(result2.totalFiles === 0);

  // 测试错误处理
  const result3 = await skill.run('nonexistent');
  assert(result3.error !== undefined);
});
```

## 最佳实践

### 1. 测试驱动开发

先写测试，再写代码：

```markdown
## 测试驱动开发流程

1. 编写测试用例
2. 运行测试（应该失败）
3. 编写最小代码使测试通过
4. 重构代码
5. 重复
```

### 2. 持续测试

每次修改后都要测试：

```markdown
## 修改流程

1. 修改代码
2. 运行测试
3. 验证功能
4. 提交代码
```

### 3. 记录测试结果

保存测试记录，方便追溯：

```markdown
# 测试记录

**日期**: 2025-01-11
**版本**: 1.0.0

## 测试结果

| 测试 | 结果 | 备注 |
|------|------|------|
| 功能测试 | ✅ | 全部通过 |
| 边界测试 | ✅ | 通过 |
| 错误测试 | ⚠️ | 需要改进权限错误提示 |
```

## 总结

测试的关键要点：

1. **全面测试** - 功能、边界、错误、用户体验
2. **分步测试** - 从简单到复杂
3. **调试技巧** - 分步、输出、简化
4. **记录结果** - 保存测试记录
5. **持续改进** - 每次修改后测试

## 下一步

1. **练习**：完成 [初级练习 5：测试基础](../../exercises/beginner/exercise-05-testing-basics.md)
2. **学习**：阅读 [教程 5：发布与分享](tutorial-05-publishing.md)
3. **实践**：为你创建的 Skill 编写测试

## 参考资源

- [最佳实践：测试策略](../03-best-practices.md#测试策略)
- [工具限制参考](../reference/tool-restrictions.md)
- [练习：测试 Skills](../../exercises/beginner/exercise-05-testing-basics.md)
